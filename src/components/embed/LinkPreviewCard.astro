---
const { url, meta } = Astro.props as {
  url: string
  meta: {
    title?: string
    description?: string
    image?: string
    site_name?: string
  }
}

let hostname = ''
try {
  const parsed = new URL(url)
  hostname = parsed.hostname.replace(/^www\./i, '')
} catch {
  hostname = url
}

const siteName = meta.site_name || hostname
const title = meta.title || hostname
const description = meta.description
const image = meta.image
const hasImage = Boolean(image)
---

<a class="tgme_widget_message_link_preview" href={url} target="_blank" rel="noopener noreferrer nofollow ugc">
  {hasImage && <img class="link_preview_image" src={image} alt="" loading="lazy" />}
  <span class="link_preview_site_name">{siteName}</span>
  <span class="link_preview_title">{title}</span>
  {description && <span class="link_preview_description">{description}</span>}
</a>
