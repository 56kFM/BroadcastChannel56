---
import SafeIframe from '../SafeIframe.astro'

const { url } = Astro.props as { url: string }

let videoId = ''
try {
  const parsed = new URL(url)
  if (/^youtu\.be$/i.test(parsed.hostname)) {
    videoId = parsed.pathname.replace(/^\//, '')
  } else if (/youtube\.com$/i.test(parsed.hostname)) {
    if (parsed.searchParams.has('v')) {
      videoId = parsed.searchParams.get('v') ?? ''
    } else {
      videoId = parsed.pathname.split('/').filter(Boolean).pop() ?? ''
    }
  }
} catch {
  videoId = ''
}

if (!videoId) {
  throw new Error('Invalid YouTube URL')
}

const srcUrl = new URL(`https://www.youtube-nocookie.com/embed/${encodeURIComponent(videoId)}`)
srcUrl.searchParams.set('rel', '0')
srcUrl.searchParams.set('color', 'white')
---

<SafeIframe
  src={srcUrl.toString()}
  title="YouTube video"
  style="height:360px;color-scheme:dark;background-color:#000;"
/>
