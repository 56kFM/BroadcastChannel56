---
// Emergency hotfix: minimal, working Embed component that restores site rendering.
// It handles first-class providers (YouTube, Bandcamp, Spotify, Apple Music) and falls back to a plain link.
// This bypasses the new resolve/oEmbed/OG layers to get the site back up immediately.

import YouTubeEmbed from './embed/providers/YouTubeEmbed.astro'
import BandcampEmbed from './embed/providers/BandcampEmbed.astro'
import SpotifyEmbed from './embed/providers/SpotifyEmbed.astro'
import AppleMusicEmbed from './embed/providers/AppleMusicEmbed.astro'

const { url } = Astro.props as { url: string }

let u: URL | null = null
try {
  u = new URL(url)
} catch {
  u = null
}

// Simple host checks for known providers
const isYouTube = u ? /(^|\.)youtube\.com$|(^|\.)youtu\.be$/i.test(u.hostname) : false
const isBandcamp = u ? /(^|\.)bandcamp\.com$/i.test(u.hostname) : false
const isSpotify = u ? /(^|\.)spotify\.com$/i.test(u.hostname) : false
const isApple = u ? /(^|\.)music\.apple\.com$/i.test(u.hostname) : false

const isInternal = /^(?:\/(?!\/)|\.\/|\.\.\/|#)/u.test(url)

const fallbackLink = isInternal ? (
  <a href={url}>{url}</a>
) : (
  <a href={url} target="_blank" rel="noopener noreferrer">
    {url}
  </a>
)
---

{
  isYouTube ? (
    <YouTubeEmbed url={url} />
  ) : isBandcamp ? (
    <BandcampEmbed url={url} />
  ) : isSpotify ? (
    <SpotifyEmbed url={url} />
  ) : isApple ? (
    <AppleMusicEmbed url={url} />
  ) : (
    fallbackLink
  )
}
