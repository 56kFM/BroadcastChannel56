---
import List from '../../components/list.astro'
import { normalizeCursorParam } from '../../lib/cursor'
import { getChannelInfo } from '../../lib/telegram'

const cursor = normalizeCursorParam(Astro.params.cursor)

if (!cursor) {
  return Astro.redirect('/')
}

const channel = await getChannelInfo(Astro, {
  after: cursor,
})

// Guard: never show an empty page
if (!Array.isArray(channel?.posts) || channel.posts.length === 0) {
  return Astro.redirect('/')
}

channel.seo = {
  noindex: true,
}
---

<List channel={channel} paginationGap={true} />
