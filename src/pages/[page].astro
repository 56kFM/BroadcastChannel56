---
import type { GetStaticPaths } from 'astro'
import List from '../components/list.astro'
import { getChannelInfo } from '../lib/telegram'
import { getPageSize } from '../lib/pagination'

export const prerender = true

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const channel = await getChannelInfo()
  const posts = Array.isArray(channel?.posts) ? channel.posts : []
  const pageSize = getPageSize()

  const pagination = paginate(posts, {
    pageSize,
    props: {
      channel,
    },
  })

  return pagination.slice(1)
}

const { page, channel } = Astro.props
const normalizedPage = {
  ...page,
  url: {
    ...page?.url,
    prev: page?.currentPage === 1 ? '/' : page?.url?.prev,
  },
}
const pagePosts = Array.isArray(page?.data) ? page.data : []
const paginatedChannel = {
  ...channel,
  posts: pagePosts,
}
---

<List channel={paginatedChannel} page={normalizedPage} paginationGap />
