---
import List from '../../../components/list.astro'
import TagHeader from '../../../components/tag-header.astro'
import { getChannelInfo } from '../../../lib/telegram'
import { normalizeTag } from '../../../lib/tags'

const rawTagParam = typeof Astro.params.tag === 'string' ? Astro.params.tag : ''
const normalizedTag = normalizeTag(rawTagParam)

if (!normalizedTag) {
  return Astro.redirect('/tags/')
}

const channel = await getChannelInfo(Astro, {
  tag: normalizedTag,
})

const tagLabel = `#${normalizedTag}`
channel.seo = {
  title: tagLabel,
  text: `Posts tagged with ${tagLabel}`,
}

const paginationBasePath = `tags/${encodeURIComponent(normalizedTag)}/`
---

<List channel={channel} before={false} after={false} paginationGap={true} paginationBasePath={paginationBasePath}>
  <TagHeader slot="header" channel={channel} tag={tagLabel} />
</List>
